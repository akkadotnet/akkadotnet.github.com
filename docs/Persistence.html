<!DOCTYPE html>
<!--[if IE 8]>			<html class="ie ie8"> <![endif]-->
<!--[if IE 9]>			<html class="ie ie9"> <![endif]-->
<!--[if gt IE 9]><!-->	<html> <!--<![endif]-->
	<head>
		<meta charset="utf-8" />
<title>Persistence | Akka.NET</title>

<meta name="keywords" content="Actor,Finite state machine, concurrency" />
<meta name="description" content="" />
<meta name="Author" content="Dorin Grigoras [www.stepofweb.com]" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />

<!-- mobile settings -->
<meta name="viewport" contenht="width=device-width, maximum-scale=1, initial-scale=1, user-scalable=0" />

<!-- Favicon -->
<link rel="shortcut icon" href="/theme_assets/images/demo/favicon.ico" />

<!-- WEB FONTS -->
<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700,800&amp;subset=latin,latin-ext" rel="stylesheet" type="text/css" />

<!-- CORE CSS -->
<link href="/theme_assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
<link href="/theme_assets/css/font-awesome.css" rel="stylesheet" type="text/css" />
<link href="/theme_assets/css/sky-forms.css" rel="stylesheet" type="text/css" />
<link href="/theme_assets/css/weather-icons.min.css" rel="stylesheet" type="text/css" />
<link href="/theme_assets/css/line-icons.css" rel="stylesheet" type="text/css" />
<link href="/theme_assets/plugins/owl-carousel/owl.pack.css" rel="stylesheet" type="text/css" />
<link href="/theme_assets/plugins/magnific-popup/magnific-popup.css" rel="stylesheet" type="text/css" />
<link href="/theme_assets/css/animate.css" rel="stylesheet" type="text/css" />
<link href="/theme_assets/css/flexslider.css" rel="stylesheet" type="text/css" />

<!-- FAV ICON -->
<link rel="shortcut icon" href="http://akkadotnet.github.io/favicon.ico?v=2" />

<!-- REVOLUTION SLIDER -->
<link href="/theme_assets/css/revolution-slider.css" rel="stylesheet" type="text/css" />
<link href="/theme_assets/css/layerslider.css" rel="stylesheet" type="text/css" />

<!-- BLOG -->
<link href="/theme_assets/css/layout-blog.css" rel="stylesheet" type="text/css" />

<!-- THEME CSS -->
<link href="/theme_assets/css/essentials.css" rel="stylesheet" type="text/css" />
<link href="/theme_assets/css/layout.css" rel="stylesheet" type="text/css" />
<link href="/theme_assets/css/header-default.css" rel="stylesheet" type="text/css" />
<link href="/theme_assets/css/footer-default.css" rel="stylesheet" type="text/css" />
<link href="/theme_assets/css/color_scheme/red.css" rel="stylesheet" type="text/css" id="color_scheme" />

<!-- Highlighting -->
<link href="https://highlightjs.org/static/styles/github.css" rel="stylesheet" type="text/css" />
<link href="/css/screen.css" rel="stylesheet" type="text/css" />

<!-- Modernizr -->
<script type="text/javascript" src="/theme_assets/plugins/modernizr.min.js"></script>

<!-- Live reload -->
<script src="//localhost:35729/livereload.js"></script>

<!--[if lte IE 8]>
  <script src="/theme_assets/plugins/respond.js"></script>
<![endif]-->

	</head>

	<!--
		Available body classes:
			smoothscroll			= enable chrome browser smooth scroll
			grey 					= grey content background
			boxed 					= boxed style
			pattern1 ... pattern10 	= background pattern

		Background Image - add to body:
			data-background="/theme_assets/images/boxed_background/1.jpg"
	-->
	<body class=" smoothscroll">

		<div id="wrapper">
			<div id="header">
  <header id="topBar">
    <div class="container">

      

      <!-- Logo -->
      <a class="logo" href="/">
        <img src="/images/akkalogo.png"  alt="" style="padding-top:0px;padding-left: 5px;" />
      </a>

    </div><!-- /.container -->
  </header>
  <div id="topNav">
  <div class="container">
    <!-- Mobile Menu Button -->
    <button class="btn btn-mobile" data-toggle="collapse" data-target=".nav-main-collapse">
      <i class="fa fa-bars"></i>
    </button>

    <!-- Search -->
    <form class="search" method="get" action="/search">
      <input type="text" class="form-control" name="q" value="" placeholder="Search">
      <button class="fa fa-search"></button>
    </form>
    <!-- /Search -->

    <!-- Top Nav -->
    <div class="navbar-collapse nav-main-collapse collapse inline-block">
      <nav class="nav-main">

      

        <!-- pageurl  -->
        <ul id="topMain" class="nav nav-pills nav-main">
          <li class="mega-menu ">
            <a href="/">
              HOME<span>&nbsp;</span>
            </a>
          </li>
          <li class="mega-menu ">
            <a href="/docs/">DOCUMENTATION<span>&nbsp;</span></a>
          </li>
          <li class="mega-menu">
            <a href="https://github.com/akkadotnet/akka.net/">CODE<span>&nbsp;</span></a>
          </li>
          <li class="mega-menu">
            <a href="https://groups.google.com/forum/#!forum/akkadotnet-user-list">MAILING LIST<span>&nbsp;</span></a>
          </li>
          <li class="mega-menu ">
            <a href="/pages/support">COMMERCIAL SUPPORT<span>&nbsp;</span></a>
          </li>
          <li class="mega-menu ">
            <a href="/docs/resources">RESOURCES<span>&nbsp;</span></a>
          </li>
        </ul>

      </nav>
    </div>
</div>
</div>
			
			<!-- PAGE TOP -->
			<section class="page-title">
				<div class="container">
					<header>
						<ul class="breadcrumb"><!-- breadcrumb -->
							<li><a href="/">Home</a></li>
							<li><a href="/docs/">Docs</a></li>
							<li class="active">Persistence<a href="https://github.com/akkadotnet/getakka.net/edit/master/src/docs/Persistence.md" > (Edit on Github)</a></li>
						</ul><!-- /breadcrumb -->

						<h2><!-- Page Title -->
							<strong>Akka.NET</strong> Docs
						</h2><!-- /Page Title -->

					</header>

				</div>
			</section>
			<!-- /PAGE TOP -->

			<!-- CONTENT -->
			<section>
				<div class="container">

					<div class="row">

						<!-- RIGHT COLUMNS -->
						<div class="col-md-3" id="toc">
						</div>
						<!-- /RIGHT COLUMNS -->

						<!-- LEFT COLUMNS -->
						<div class="col-md-8 docs-content">
							<div id="main_content">

								<div><h2 id="persistence">Persistence</h2>
<p>Akka.Persistence plugin enables to create a stateful actors, which internal state may be stored inside persistent data storage and used for recovery in case of restart, migration or VM crash. Core concept behind Akka persistence lays in storing not only actor state directly (in form of the snapshots) but also history of all of the changes of that actor&#39;s state. This is quite useful solution common in patterns such as eventsourcing. Changes are immutable by nature, as they describe facts already reported in the history, and can be stored inside event journal in append-only mode. While recovering, actor restores it&#39;s state from the latests snapshot available - which can reduce recovery time - and then recreates it further by replaying events stored inside journal. Among other features provided by persistence plugin is support for command query segregation model and point-to-point communication with at-least-once delivery semantics.</p>
<h3 id="architecture">Architecture</h3>
<p>Akka.Persistence features are available through new set of actor base classes:</p>
<ul>
<li><code>PersistentActor</code> is a persistent, stateful equivalent of <em>ActorBase</em> class. It&#39;s able to persist event inside the journal, creating snapshots in snapshot stores and recover from them in thread-safe manner. It can be used for both changing and reading state of the actor.</li>
<li><code>PersistentView</code> is used to recreate internal state of other persistent actor based on journaled messages. It works in read-only manner - it cannot journal any event by itself.</li>
<li><code>GuaranteedDeliveryActor</code> may be used to ensure at-least-once delivery semantics between communicating actors, even in case when either sender or receiver VM crashes.</li>
<li><code>Journal</code> stores a sequence of events send by the persistent actor. The storage backend of the journal is pluggable. By default it uses in-memory message stream and is NOT a persistent storage.</li>
<li><code>Snapshot store</code> is used to persist snapshots of either persistent actor&#39;s or view&#39;s internal state. They can be used to reduce recovery times in case when a lot of events needs to be replayed for specific persistent actor. Storage backend of the snapshot store is pluggable. By default it uses local file system.</li>
</ul>
<h3 id="persistent-actors">Persistent actors</h3>
<p>Unlike default <code>ActorBase</code> class <code>PersistentActor</code> and it&#39;s derivatives requires to setup a few more additional members:</p>
<ul>
<li><code>PersistenceId</code> is a persistent actor&#39;s identifier that doesn&#39;t change across different actor incarnations. It&#39;s used to retrieve an event stream required by the persistent actor to recover it&#39;s internal state.</li>
<li><code>ReceiveRecover</code> is a method invoked during actor&#39;s recovery cycle. Incoming objects may be user-defined events as well as system messages, for example <code>SnapshotOffer</code> which is used to deliver latest actor state saved in the snapshot store.</li>
<li><code>ReceiveCommand</code> is an equivalent of basic <code>Receive</code> method of default Akka.NET actors.</li>
</ul>
<p>Persistent actors also offer a set of specialized members:</p>
<ul>
<li><code>Persist</code> and <code>PersistAsync</code> methods can be used to send events to event journal in order to store them inside. Second argument in a callback invoked when journal confirms, that events have been stored successfully.</li>
<li><code>Defer</code> and <code>DeferAsync</code> are used to perform various operations <em>after</em> events will be persisted and their callback handlers will be invoked. Unlike persist methods, defer won&#39;t store and event in a persistent storage. Defer methods may NOT be invoked in case when actor is restarted even thou journal will successfully persist events sent.</li>
<li><code>DeleteMessages</code> will order attached journal to remove part of it&#39;s events. It can be either logical deletion - messages are marked as deleted, but are not removed physically from the backend storage - or a physical one, when the messages are removed physically from the journal.</li>
<li><code>LoadSnapshot</code> will sent request to snapshot store to resent a current actor&#39;s snapshot.</li>
<li><code>SaveSnapshot</code> will sent current actor&#39;s internal state as snapshot to be saved by configured snapshot store.</li>
<li><code>DeleteSnapshot</code> and <code>DeleteSnapshots</code> methods may be used to specify snapshots to be removed from snapshot store in case, when they are no longer needed.</li>
<li><code>OnReplaySuccess</code> is a virtual method which will be called when recovery cycle will end successfully.</li>
<li><code>OnReplayFailure</code> is a virtual method which will be called when recovery cycle will fail unexpectedly from some reason.</li>
<li><code>IsRecovering</code> property determines if current actor is performing a recovery cycle at the moment.</li>
<li><code>SnapshotSequenceNr</code> property may be used to determine sequence number used for marking persisted events. This value is changing in monotically increasing manner.</li>
</ul>
<p>In case when a manual recovery cycle initialization is necessary, it may be invoked by sending a <code>Recover</code> message to persistent actor.</p>
<h3 id="persistent-views">Persistent views</h3>
<p>While persistent actor may be used to producing and persisting an events, views are used only to read internal state based on them. Like persistent actor, view has a <code>PersistenceId</code> to specify collection of events to be resent to current view. This value should however be correlated with PersistentId of actor - producer of the events.</p>
<p>Other members:</p>
<ul>
<li><code>ViewId</code> property is an view unique identifier that doesn&#39;t change across different actor incarnations. It&#39;s useful in case when there should be a multiple different views associated with a single persistent actor, but showing it&#39;s state from a different perspectives.</li>
<li><code>IsAutoUpdate</code> property determines if view will try to automatically update it&#39;s state in specified time intervals. Without it, view won&#39;t update it&#39;s state until it receives an explicit <code>Update</code> message. This value can be set through configuration with <em>akka.persistence.view.auto-update</em> set to either <em>on</em> (by default) or <em>off</em>.</li>
<li><code>AutoUpdateInterval</code> specifies time interval in which view will be updating itself - only in case when <em>IsAutoUpdate</em> flag is on. This value can be set through configuration with <em>akka.persistence.view.auto-update-interval</em> key (5 seconds by default).</li>
<li><code>AutoUpdateReplayMax</code> property determines maximum number of events to be replayed during a single <em>Update</em> cycle. This value can be set through configuration with <em>akka.persistence.view.auto-update-replay-max</em> key (by default it&#39;s -1 - no limit).</li>
<li><code>LoadSnapshot</code> will sent request to snapshot store to resent a current view&#39;s snapshot.</li>
<li><code>SaveSnapshot</code> will sent current view&#39;s internal state as snapshot to be saved by configured snapshot store.</li>
<li><code>DeleteSnapshot</code> and <code>DeleteSnapshots</code> methods may be used to specify snapshots to be removed from snapshot store in case, when they are no longer needed.</li>
</ul>
<h3 id="guaranteed-delivery">Guaranteed delivery</h3>
<p>Guaranteed delivery actors are specializations of persistent actors and may be used to provide at-least-once delivery semantics, even in case when one of the communication endpoints will crash. Because it&#39;s possible that the same message will be send twice, actor&#39;s receive behavior must work in the idempotent manner.</p>
<p>Members:</p>
<ul>
<li><code>Deliver</code> method is used to send message to another actor in at-least-once delivery semantics. Message sent this way must be confirmed by the other endpoint with <code>ConfirmDelivery</code> method. Otherwise it will be resend again and again until the redelivery limit will be reached.</li>
<li><code>GetDeliverySnapshot</code> and <code>SetDeliverySnapshot</code> methods are used as part of delivery snapshotting strategy. They return/reset state of the current guaranteed delivery actor unconfirmed messages. In order to save custom deliverer state inside snapshot, a returned delivery snapshot should be included into that snapshot and reset in <em>ReceiveRecovery</em> method, when <code>SnapshotOffer</code> arrives.</li>
<li><code>RedeliveryBurstLimit</code> is a virtual property which determines maximum number of unconfirmed messages to be send in each redelivery attempt. It may be useful to prevent message overflow scenarios. It may be overridden or configured inside HOCON configuration under <em>akka.persistence.at-least-once-delivery.redelivery-burst-limit</em> path (10 000 by default).</li>
<li><code>UnconfirmedDeliveryAttemptsToWarn</code> is a virtual property which determines, how many unconfirmed deliveries may be sent before guaranteed delivery actor will send an <code>UnconfirmedWarning</code> message to itself. Count is reset after actor&#39;s restart. It may be overridden or configured inside HOCON configuration under <em>akka.persistence.at-least-once-delivery.warn-after-number-of-unconfirmed-attempts</em> path (5 by default).</li>
<li><code>MaxUnconfirmedMessages</code> is a virtual property which determines maximum of unconfirmed deliveries hold in memory. After this threshold is exceeded any <code>Deliver</code> method will raise <code>MaxUnconfirmedMessagesExceededException</code>. It may be overridden or configured inside HOCON configuration under <em>akka.persistence.at-least-once-delivery.max-unconfirmed-messages</em> path (100 000 by default).</li>
<li><code>UnconfirmedCount</code> property shows a number of the unconfirmed messages.</li>
</ul>
<h3 id="journals">Journals</h3>
<p>Journal is a specialized type of an actor, which exposes an API to handle incoming events and store them in backend storage. By default Akka.Persitence uses a <code>MemoryJournal</code> which stores all events in memory and therefore it&#39;s not a persistent storage. Custom journal configuration path may be specified inside <em>akka.persistence.journal.plugin</em> path and by default it requires two keys set: <em>class</em> and <em>plugin-dispatcher</em>. Example configuration:</p>
<pre><code class="hljs lang-hocon"><span class="hljs-title">akka</span> {
    <span class="hljs-title">persistence</span> {
        <span class="hljs-title">journal</span> {

            <span class="hljs-comment"># Path to the journal plugin to be used</span>
            <span class="hljs-title">plugin</span> = <span class="hljs-string">"akka.persistence.journal.inmem"</span>

            <span class="hljs-comment"># In-memory journal plugin.</span>
            inmem {

                <span class="hljs-comment"># Class name of the plugin.</span>
                <span class="hljs-title">class</span> = <span class="hljs-string">"Akka.Persistence.Journal.MemoryJournal, Akka.Persistence"</span>

                <span class="hljs-comment"># Dispatcher for the plugin actor.</span>
                plugin-dispatcher = <span class="hljs-string">"akka.actor.default-dispatcher"</span>
            }
        }
    }
}
</code></pre>
<h3 id="snapshot-store">Snapshot store</h3>
<p>Snapshot store is a specialized type of an actor, which exposes an API to handle incoming snapshot-related requests and is able to save snapshots in some backend storage. By default Akka.Persistence uses a <code>LocalSnapshotStore</code>, which uses a local file system as a storage. Custom snapshot store configuration path may be specified inside <em>akka.persistence.snapshot-store.plugin</em> path and by default it requires two keys set: <em>class</em> and <em>plugin-dispatcher</em>. Example configuration:</p>
<pre><code class="hljs lang-hocon">akka {
    persistence {
        snapshot-store {

            <span class="hljs-comment"># Path to the snapshot store plugin to be used</span>
            <span class="hljs-variable">plugin =</span> <span class="hljs-string">"akka.persistence.snapshot-store.local"</span>

            <span class="hljs-comment"># Local filesystem snapshot store plugin.</span>
            local {

                <span class="hljs-comment"># Class name of the plugin.</span>
                <span class="hljs-variable">class =</span> <span class="hljs-string">"Akka.Persistence.Snapshot.LocalSnapshotStore, Akka.Persistence"</span>

                <span class="hljs-comment"># Dispatcher for the plugin actor.</span>
                <span class="hljs-variable">plugin-dispatcher =</span> <span class="hljs-string">"akka.persistence.dispatchers.default-plugin-dispatcher"</span>

                <span class="hljs-comment"># Dispatcher for streaming snapshot IO.</span>
                <span class="hljs-variable">stream-dispatcher =</span> <span class="hljs-string">"akka.persistence.dispatchers.default-stream-dispatcher"</span>

                <span class="hljs-comment"># Storage location of snapshot files.</span>
                <span class="hljs-variable">dir =</span> <span class="hljs-string">"snapshots"</span>
            }
        }
    }
}
</code></pre>
<h3 id="contributing">Contributing</h3>
<p>Akka persistence plugin gives a custom journal and snapshot store creator a built-in set of test, which can be used to verify correctness of the implemented backend storage plugins. It&#39;s available through <code>Akka.Persistence.TestKit</code> package and uses xUnit as default test framework.</p>
</div>

								

						</div>
						<div class="col-md-1">&nbsp;</div>
						<!-- /LEFT COLUMNS -->



					</div>

				</div>
			</section>
			<!-- /CONTENT -->

			<footer id="footer">
  <div class="container">
    <div class="row">
        <!-- col #1 -->
        <div class="spaced dark col-md-3">
            <h4>About <strong>Akka.NET</strong></h4>
            <p class="block">
                Akka.NET is a port of the popular
                <br/> Java/Scala framework <a href="http://akka.io">Akka</a> to .NET.
                <br/>
                <br/> This is a community driven port and
                <br/> is not affiliated with <a href="http://typesafe.com">Typesafe</a> who
                <br/> makes the original Java/Scala version.
                <br/>
            </p>
            <!-- social -->
            <p class="block">
                <a href="mailto:hi@getakka.net">hi@getakka.net</a><br>
                <a href="https://www.facebook.com/akkadotnet" class="social fa fa-facebook"></a>
                <a href="http://stackoverflow.com/questions/tagged/akka.net" class="social fa fa-stack-overflow"></a>
                <a href="https://twitter.com/AkkaDotNET" class="social fa fa-twitter"></a>
            </p><!-- /social -->
        </div>
        <!-- /col #1 -->
        <!-- col #3 -->
        <div class="spaced col-md-6 col-sm-4">
            <h4>Recent <strong>Tweets</strong></h4>
            <ul class="list-unstyled fsize13" id="recent_tweets">
            </ul>
        </div>
        <!-- /col #3 -->
        <div class="spaced col-md-3 col-sm-4">
            <h4>Keep <strong>Updated</strong></h4>
            <h4><small><strong>Subscribe to our Newsletter</strong></small></h4>
            <!-- Begin MailChimp Signup Form -->
<div id="mc_embed_signup">
    <form class="input-group" action="//github.us8.list-manage.com/subscribe/post?u=945d2a2edaa89aaabd396bc45&amp;id=5f9a7a993d" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
        <input type="email" value="" name="EMAIL" class="form-control placeholder required email" id="mce-EMAIL" placeholder="E-mail Address">
        <span class="input-group-btn">
  <button class="btn btn-primary" type="submit" name="subscribe" id="mc-embedded-subscribe">SUBMIT</button>
</span>
        <div id="mce-responses" class="clear">
            <div class="response" id="mce-error-response" style="display:none"></div>
            <div class="response" id="mce-success-response" style="display:none"></div>
        </div>
        <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
        <div style="position: absolute; left: -5000px;">
            <input type="text" name="b_945d2a2edaa89aaabd396bc45_5f9a7a993d" tabindex="-1" value="">
        </div>
        <div class="clear"></div>
    </form>
</div>
<!--End mc_embed_signup-->

        </div>
    </div>
  </div>
  <hr />
  <!-- <div class="copyright">
    <div class="container text-center fsize12"></div>
  </div> -->
</footer>


			<a href="#" id="toTop"></a>

		</div><!-- /#wrapper -->

		<script type="text/javascript" src="/theme_assets/plugins/jquery-2.1.1.min.js"></script>
<script type="text/javascript" src="/theme_assets/plugins/jquery.isotope.js"></script>
<script type="text/javascript" src="/theme_assets/plugins/masonry.js"></script>
<script type="text/javascript" src="/theme_assets/plugins/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/theme_assets/plugins/magnific-popup/jquery.magnific-popup.min.js"></script>
<script type="text/javascript" src="/theme_assets/plugins/owl-carousel/owl.carousel.min.js"></script>
<script type="text/javascript" src="/theme_assets/plugins/knob/js/jquery.knob.js"></script>
<script type="text/javascript" src="/theme_assets/plugins/flexslider/jquery.flexslider-min.js"></script>

<!-- REVOLUTION SLIDER -->
<script type="text/javascript" src="/theme_assets/plugins/revolution-slider/js/jquery.themepunch.plugins.min.js"></script>
<script type="text/javascript" src="/theme_assets/plugins/revolution-slider/js/jquery.themepunch.revolution.min.js"></script>
<script type="text/javascript" src="/theme_assets/js/revolution_slider.js"></script>
<script type="text/javascript" src="/js/jquery-toc.js"></script>
<script type="text/javascript" src="/theme_assets/js/scripts.js"></script>
<script type="text/javascript" src="/js/scripts.js"></script>
		<!-- REACTIVE MANIFESTO BANNER -->
<a href="http://www.reactivemanifesto.org/"> <img style="border: 0; position: fixed; right: 0; top:0; z-index: 9000; max-width: 125px;" src="//d379ifj7s9wntv.cloudfront.net/reactivemanifesto/images/ribbons/we-are-reactive-red-right.png"> </a>

	</body>
</html>
