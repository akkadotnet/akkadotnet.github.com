<!DOCTYPE html>
<!--[if IE 8]>			<html class="ie ie8"> <![endif]-->
<!--[if IE 9]>			<html class="ie ie9"> <![endif]-->
<!--[if gt IE 9]><!-->	<html> <!--<![endif]-->
	<head>
		
		<meta charset="utf-8" />
		<title>DI Core | Akka.NET</title>
		
		<meta name="keywords" content="Actor,Finite state machine, concurrency" />
		<meta name="description" content="" />
		<meta name="Author" content="Dorin Grigoras [www.stepofweb.com]" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		
		<!-- mobile settings -->
		<meta name="viewport" contenht="width=device-width, maximum-scale=1, initial-scale=1, user-scalable=0" />
		
		<!-- Favicon -->
		<link rel="shortcut icon" href="/theme_assets/images/demo/favicon.ico" />
		
		<!-- WEB FONTS -->
		<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700,800&amp;subset=latin,latin-ext" rel="stylesheet" type="text/css" />
		
		<!-- CORE CSS -->
		<link href="/theme_assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
		<link href="/theme_assets/css/font-awesome.css" rel="stylesheet" type="text/css" />
		<link href="/theme_assets/css/sky-forms.css" rel="stylesheet" type="text/css" />
		<link href="/theme_assets/css/weather-icons.min.css" rel="stylesheet" type="text/css" />
		<link href="/theme_assets/css/line-icons.css" rel="stylesheet" type="text/css" />
		<link href="/theme_assets/plugins/owl-carousel/owl.pack.css" rel="stylesheet" type="text/css" />
		<link href="/theme_assets/plugins/magnific-popup/magnific-popup.css" rel="stylesheet" type="text/css" />
		<link href="/theme_assets/css/animate.css" rel="stylesheet" type="text/css" />
		<link href="/theme_assets/css/flexslider.css" rel="stylesheet" type="text/css" />
		
		<!-- FAV ICON -->
		<link rel="shortcut icon" href="http://akkadotnet.github.io/favicon.ico?v=2" />
		
		<!-- REVOLUTION SLIDER -->
		<link href="/theme_assets/css/revolution-slider.css" rel="stylesheet" type="text/css" />
		<link href="/theme_assets/css/layerslider.css" rel="stylesheet" type="text/css" />
		
		<!-- BLOG -->
		<link href="/theme_assets/css/layout-blog.css" rel="stylesheet" type="text/css" />
		
		<!-- THEME CSS -->
		<link href="/theme_assets/css/essentials.css" rel="stylesheet" type="text/css" />
		<link href="/theme_assets/css/layout.css" rel="stylesheet" type="text/css" />
		<link href="/theme_assets/css/header-default.css" rel="stylesheet" type="text/css" />
		<link href="/theme_assets/css/footer-default.css" rel="stylesheet" type="text/css" />
		<link href="/theme_assets/css/color_scheme/red.css" rel="stylesheet" type="text/css" id="color_scheme" />
		
		<!-- Highlighting -->
		<link href="https://highlightjs.org/static/styles/github.css" rel="stylesheet" type="text/css" />
		<link href="/css/screen.css" rel="stylesheet" type="text/css" />
		
		<!-- Modernizr -->
		<script type="text/javascript" src="/theme_assets/plugins/modernizr.min.js"></script>
		
		<!--[if lte IE 8]>
		  <script src="/theme_assets/plugins/respond.js"></script>
		<![endif]-->
	</head>

	<!--
		Available body classes:
			smoothscroll			= enable chrome browser smooth scroll
			grey 					= grey content background
			boxed 					= boxed style
			pattern1 ... pattern10 	= background pattern

		Background Image - add to body:
			data-background="/theme_assets/images/boxed_background/1.jpg"
	-->
	<body class=" smoothscroll">

		<div id="wrapper">
			<div id="header">
			  <header id="topBar">
			    <div class="container">
			
			
			      <!-- Logo -->
			      <a class="logo" href="/">
			        <img src="/images/akkalogo.png"  alt="" style="padding-top:0px;padding-left: 5px;" />
			      </a>
			
			    </div><!-- /.container -->
			  </header>
			  <div id="topNav">
			    <div class="container">
			      <!-- Mobile Menu Button -->
			      <button class="btn btn-mobile" data-toggle="collapse" data-target=".nav-main-collapse">
			        <i class="fa fa-bars"></i>
			      </button>
			  
			      <!-- Search -->
			      <form class="search" method="get" action="/search">
			        <input type="text" class="form-control" name="q" value="" placeholder="Search">
			        <button class="fa fa-search"></button>
			      </form>
			      <!-- /Search -->
			  
			      <!-- Top Nav -->
			      <div class="navbar-collapse nav-main-collapse collapse inline-block">
			        <nav class="nav-main">
			  
			  
			          <!-- pageurl  -->
			          <ul id="topMain" class="nav nav-pills nav-main">
			            <li class="mega-menu  active">
			              <a href="/docs/">DOCUMENTATION<span>&nbsp;</span></a>
			            </li>
			            <li class="mega-menu">
			              <a href="https://github.com/akkadotnet/akka.net/">CODE<span>&nbsp;</span></a>
			            </li>
			            <li class="mega-menu">
			              <a href="https://gitter.im/akkadotnet/akka.net">PROJECT CHAT<span>&nbsp;</span></a>
			            </li>
			            <li class="mega-menu">
			              <a href="https://groups.google.com/forum/#!forum/akkadotnet-user-list">MAILING LIST<span>&nbsp;</span></a>
			            </li>
			            <li class="mega-menu ">
			              <a href="/pages/support">COMMERCIAL SUPPORT<span>&nbsp;</span></a>
			            </li>
			            <li class="mega-menu ">
			              <a href="/docs/Resources">RESOURCES<span>&nbsp;</span></a>
			            </li>
			          </ul>
			  
			        </nav>
			      </div>
			  </div></div>			
			<!-- PAGE TOP -->
			<section class="page-title">
				<div class="container">
					<header>
						<ul class="breadcrumb"><!-- breadcrumb -->
							<li><a href="/">Home</a></li>
							<li><a href="/docs/">Docs</a></li>
							<li class="active">DI Core<a href="https://github.com/akkadotnet/getakka.net/edit/master/src/docs/DI Core.md" > (Edit on Github)</a></li>
						</ul><!-- /breadcrumb -->

						<h2><!-- Page Title -->
							<strong>Akka.NET</strong> Docs
						</h2><!-- /Page Title -->

					</header>

				</div>
			</section>
			<!-- /PAGE TOP -->

			<!-- CONTENT -->
			<section>
				<div class="container">

					<div class="row">

						<!-- RIGHT COLUMNS -->
						<div class="col-md-3" id="toc">
						</div>
						<!-- /RIGHT COLUMNS -->

						<!-- LEFT COLUMNS -->
						<div class="col-md-8 docs-content">
							<div id="main_content">

<div><h1 id="akka-di-core">Akka.DI.Core</h1>
<p><strong>Actor Producer Extension</strong> library used to create Dependency Injection
Container for the <a href="https://github.com/akkadotnet/akka.net">Akka.NET</a> framework.</p>
<h1 id="what-is-it-">What is it?</h1>
<p><strong>Akka.DI.Core</strong> is an <strong>ActorSystem extension</strong> library for the Akka.NET
framework that provides a simple way to create an Actor Dependency Resolver
that can be used an alternative to the basic capabilities of <a href="Props">Props</a>
when you have actors with multiple dependencies.</p>
<h1 id="how-do-you-create-an-extension-">How do you create an Extension?</h1>
<ul>
<li>Create a new class library</li>
<li>Reference your favorite IoC Container, the Akka.DI.Core and of course Akka</li>
<li>Create a class and implement the <code>IDependencyResolver</code></li>
</ul>
<p>Let&#39;s walk through the process of creating one for the CastleWindsor container.
You need to create  a new project named Akka.DI.CastleWindsor with all the
necessary references including Akka.DI.Core, Akka and CastleWindosor.
Name the initial class <code>WindsorDependencyResolver</code>.</p>
<pre><code class="hljs lang-csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">WindsorDependencyResolver</span> : <span class="hljs-title">IDependencyResolver</span>
{
    <span class="hljs-comment">// we'll implement IDependencyResolver in the following steps</span>
}
</code></pre>
<p>Add a constructor and private fields.</p>
<pre><code class="hljs lang-csharp"><span class="hljs-keyword">private</span> IWindsorContainer _container;
<span class="hljs-keyword">private</span> ConcurrentDictionary&lt;<span class="hljs-keyword">string</span>, Type&gt; _typeCache;
<span class="hljs-keyword">private</span> ActorSystem _system;

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">WindsorDependencyResolver</span><span class="hljs-params">(IWindsorContainer container, ActorSystem system)</span>
</span>{
    <span class="hljs-keyword">if</span> (system == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-string">"system"</span>);
    <span class="hljs-keyword">if</span> (container == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-string">"container"</span>);
    _container = container;
    _typeCache = <span class="hljs-keyword">new</span> ConcurrentDictionary&lt;<span class="hljs-keyword">string</span>, Type&gt;(StringComparer.InvariantCultureIgnoreCase);
    _system = system;
    _system.AddDependencyResolver(<span class="hljs-keyword">this</span>);
}
</code></pre>
<p>You have defined three private fields</p>
<ul>
<li><code>IWindsorContainer _container</code> is a reference to the CastleWindsor
   container.</li>
<li><code>ConcurrentDictionary&lt;string, Type&gt; _typeCache</code> is a thread safe map that
   contains actor name/type associations.</li>
<li><code>ActorSystem _system</code> is a reference to the ActorSystem.</li>
</ul>
<p>First you need to implement <code>GetType</code>. This is a basic implementation and
is just for demonstration purposes. Essentially this is used by the extension
to get the type of the actor from it&#39;s type name.</p>
<pre><code class="hljs lang-csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> Type <span class="hljs-title">GetType</span><span class="hljs-params">(<span class="hljs-keyword">string</span> actorName)</span>
</span>{
    _typeCache.
        TryAdd(actorName,
            actorName.GetTypeValue() ??
            _container.Kernel
            .GetAssignableHandlers(<span class="hljs-keyword">typeof</span>(<span class="hljs-keyword">object</span>))
            .Where(handler =&gt; handler.ComponentModel.Name.Equals(actorName, StringComparison.InvariantCultureIgnoreCase))
            .Select(handler =&gt; handler.ComponentModel.Implementation)
            .FirstOrDefault());

     <span class="hljs-keyword">return</span> _typeCache[actorName];
}
</code></pre>
<p>Secondly you need to implement the <code>CreateActorFactory</code> method which will be
used by the extension to create the actor. This implementation will depend upon
the API of the container.</p>
<pre><code class="hljs lang-csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> Func&lt;ActorBase&gt; <span class="hljs-title">CreateActorFactory</span><span class="hljs-params">(Type actorType)</span>
</span>{
    <span class="hljs-keyword">return</span> () =&gt; (ActorBase)container.Resolve(actorType);
}
</code></pre>
<p>Thirdly, you implement the <code>Create&lt;TActor&gt;</code> which is used register the
<code>Props</code> configuration for the referenced actor type with the <code>ActorSystem</code>.
This method will always be the same implementation.</p>
<pre><code class="hljs lang-csharp"><span class="hljs-keyword">public</span> Props Create&lt;TActor&gt;() <span class="hljs-keyword">where</span> TActor : ActorBase
{
    <span class="hljs-keyword">return</span> system.GetExtension&lt;DIExt&gt;().Props(<span class="hljs-keyword">typeof</span>(TActor).Name);
}
</code></pre>
<p>Lastly, you implement the Release method which in this instance is very simple.
This method is used to remove the actor from the underlying container.</p>
<pre><code class="hljs lang-csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Release</span><span class="hljs-params">(ActorBase actor)</span>
</span>{
    <span class="hljs-keyword">this</span>.container.Release(actor);
}
</code></pre>
<p><strong>Note: For further details on the importance of the release method please read
the following blog <a href="http://blog.ploeh.dk/2014/05/19/di-friendly-framework/">post</a>.</strong></p>
<p>The resulting class should look similar to the following:</p>
<pre><code class="hljs lang-csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">WindsorDependencyResolver</span> : <span class="hljs-title">IDependencyResolver</span>
{
    <span class="hljs-keyword">private</span> IWindsorContainer container;
    <span class="hljs-keyword">private</span> ConcurrentDictionary&lt;<span class="hljs-keyword">string</span>, Type&gt; typeCache;
    <span class="hljs-keyword">private</span> ActorSystem system;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">WindsorDependencyResolver</span><span class="hljs-params">(IWindsorContainer container, ActorSystem system)</span>
    </span>{
        <span class="hljs-keyword">if</span> (system == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-string">"system"</span>);
        <span class="hljs-keyword">if</span> (container == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-string">"container"</span>);
        <span class="hljs-keyword">this</span>.container = container;
        typeCache = <span class="hljs-keyword">new</span> ConcurrentDictionary&lt;<span class="hljs-keyword">string</span>, Type&gt;(StringComparer.InvariantCultureIgnoreCase);
        <span class="hljs-keyword">this</span>.system = system;
        <span class="hljs-keyword">this</span>.system.AddDependencyResolver(<span class="hljs-keyword">this</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> Type <span class="hljs-title">GetType</span><span class="hljs-params">(<span class="hljs-keyword">string</span> actorName)</span>
    </span>{
        typeCache.TryAdd(actorName, actorName.GetTypeValue() ??
            container.Kernel
              .GetAssignableHandlers(<span class="hljs-keyword">typeof</span>(<span class="hljs-keyword">object</span>))
              .Where(handler =&gt; handler.ComponentModel.Name.Equals(actorName, StringComparison.InvariantCultureIgnoreCase))
              .Select(handler =&gt; handler.ComponentModel.Implementation)
              .FirstOrDefault());

        <span class="hljs-keyword">return</span> typeCache[actorName];
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> Func&lt;ActorBase&gt; <span class="hljs-title">CreateActorFactory</span><span class="hljs-params">(Type actorType)</span>
    </span>{
        <span class="hljs-keyword">return</span> () =&gt; (ActorBase)container.Resolve(actorType);
    }

    <span class="hljs-keyword">public</span> Props Create&lt;TActor&gt;() <span class="hljs-keyword">where</span> TActor : ActorBase
    {
        <span class="hljs-keyword">return</span> system.GetExtension&lt;DIExt&gt;().Props(<span class="hljs-keyword">typeof</span>(TActor));
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Release</span><span class="hljs-params">(ActorBase actor)</span>
    </span>{
        <span class="hljs-keyword">this</span>.container.Release(actor);
    }
}
</code></pre>
<p>Now, with the preceding class, you can do something like the following example:</p>
<pre><code class="hljs lang-csharp"><span class="hljs-comment">// Setup CastleWindsor</span>
IWindsorContainer container = <span class="hljs-keyword">new</span> WindsorContainer();
container.Register(Component.For&lt;IWorkerService&gt;().ImplementedBy&lt;WorkerService&gt;());
container.Register(Component.For&lt;TypedWorker&gt;().Named(<span class="hljs-string">"TypedWorker"</span>).LifestyleTransient());

<span class="hljs-comment">// Create the ActorSystem</span>
<span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> system = ActorSystem.Create(<span class="hljs-string">"MySystem"</span>))
{
    <span class="hljs-comment">// Create the dependency resolver</span>
    IDependencyResolver resolver = <span class="hljs-keyword">new</span> WindsorDependencyResolver(container, system);

    <span class="hljs-comment">// Register the actors with the system</span>
    system.ActorOf(resolver.Create&lt;TypedWorker&gt;(), <span class="hljs-string">"Worker1"</span>);
    system.ActorOf(resolver.Create&lt;TypedWorker&gt;(), <span class="hljs-string">"Worker2"</span>);

    <span class="hljs-comment">// Create the router</span>
    IActorRef router = system.ActorOf(Props.Empty.WithRouter(<span class="hljs-keyword">new</span> ConsistentHashingGroup(config)));

    <span class="hljs-comment">// Create the message to send</span>
    TypedActorMessage message = <span class="hljs-keyword">new</span> TypedActorMessage
    {
       Id = <span class="hljs-number">1</span>,
       Name = Guid.NewGuid().ToString()
    };

    <span class="hljs-comment">// Send the message to the router</span>
    router.Tell(message);
}
</code></pre>
<h2 id="creating-child-actors-using-di">Creating Child Actors using DI</h2>
<p>When you want to create child actors from within your existing actors using
Dependency Injection you can use the Actor Content extension just like in
the following example.</p>
<pre><code class="hljs lang-csharp">Context.DI().ActorOf&lt;TypedActor&gt;().Tell(message);
</code></pre>
</div>

						</div>
						<div class="col-md-1">&nbsp;</div>
						<!-- /LEFT COLUMNS -->



					</div>

				</div>
			</section>
			<!-- /CONTENT -->

			<footer id="footer">
			  <div class="container">
			    <div class="row">
			        <!-- col #1 -->
			        <div class="spaced dark col-md-3">
			            <h4>About <strong>Akka.NET</strong></h4>
			            <p class="block">
			                Akka.NET is a port of the popular
			                <br/> Java/Scala framework <a href="http://akka.io">Akka</a> to .NET.
			                <br/>
			                <br/> This is a community driven port and
			                <br/> is not affiliated with <a href="http://typesafe.com">Typesafe</a> who
			                <br/> makes the original Java/Scala version.
			                <br/>
			            </p>
			            <!-- social -->
			            <p class="block">
			                <a href="mailto:hi@getakka.net">hi@getakka.net</a><br>
			                <a href="https://www.facebook.com/akkadotnet" class="social fa fa-facebook"></a>
			                <a href="http://stackoverflow.com/questions/tagged/akka.net" class="social fa fa-stack-overflow"></a>
			                <a href="https://twitter.com/AkkaDotNET" class="social fa fa-twitter"></a>
			            </p><!-- /social -->
			        </div>
			        <!-- /col #1 -->
			        <!-- col #3 -->
			        <div class="spaced col-md-6 col-sm-4">
			            <h4>Recent <strong>Tweets</strong></h4>
			            <ul class="list-unstyled fsize13" id="recent_tweets">
			            </ul>
			        </div>
			        <!-- /col #3 -->
			        <div class="spaced col-md-3 col-sm-4">
			            <h4>Keep <strong>Updated</strong></h4>
			            <h4><small><strong>Subscribe to our Newsletter</strong></small></h4>
			            <!-- Begin MailChimp Signup Form -->
			            <div id="mc_embed_signup">
			                <form class="input-group" action="//github.us8.list-manage.com/subscribe/post?u=945d2a2edaa89aaabd396bc45&amp;id=5f9a7a993d" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
			                    <input type="email" value="" name="EMAIL" class="form-control placeholder required email" id="mce-EMAIL" placeholder="E-mail Address">
			                    <span class="input-group-btn">
			              <button class="btn btn-primary" type="submit" name="subscribe" id="mc-embedded-subscribe">SUBMIT</button>
			            </span>
			                    <div id="mce-responses" class="clear">
			                        <div class="response" id="mce-error-response" style="display:none"></div>
			                        <div class="response" id="mce-success-response" style="display:none"></div>
			                    </div>
			                    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
			                    <div style="position: absolute; left: -5000px;">
			                        <input type="text" name="b_945d2a2edaa89aaabd396bc45_5f9a7a993d" tabindex="-1" value="">
			                    </div>
			                    <div class="clear"></div>
			                </form>
			            </div>
			            <!--End mc_embed_signup-->
			        </div>
			    </div>
			  </div>
			  <hr />
			  <!-- <div class="copyright">
			    <div class="container text-center fsize12"></div>
			  </div> -->
			</footer>

			<a href="#" id="toTop"></a>

		</div><!-- /#wrapper -->

		<script type="text/javascript" src="/theme_assets/plugins/jquery-2.1.1.min.js"></script>
		<script type="text/javascript" src="/theme_assets/plugins/jquery.isotope.js"></script>
		<script type="text/javascript" src="/theme_assets/plugins/masonry.js"></script>
		<script type="text/javascript" src="/theme_assets/plugins/bootstrap/js/bootstrap.min.js"></script>
		<script type="text/javascript" src="/theme_assets/plugins/magnific-popup/jquery.magnific-popup.min.js"></script>
		<script type="text/javascript" src="/theme_assets/plugins/owl-carousel/owl.carousel.min.js"></script>
		<script type="text/javascript" src="/theme_assets/plugins/knob/js/jquery.knob.js"></script>
		<script type="text/javascript" src="/theme_assets/plugins/flexslider/jquery.flexslider-min.js"></script>
		
		<!-- REVOLUTION SLIDER -->
		<script type="text/javascript" src="/theme_assets/plugins/revolution-slider/js/jquery.themepunch.plugins.min.js"></script>
		<script type="text/javascript" src="/theme_assets/plugins/revolution-slider/js/jquery.themepunch.revolution.min.js"></script>
		<script type="text/javascript" src="/theme_assets/js/revolution_slider.js"></script>
		<script type="text/javascript" src="/js/jquery-toc.js"></script>
		<script type="text/javascript" src="/theme_assets/js/scripts.js"></script>
		<script type="text/javascript" src="/js/scripts.js"></script>		<!-- REACTIVE MANIFESTO BANNER -->
		<a href="http://www.reactivemanifesto.org/"> <img style="border: 0; position: fixed; right: 0; top:0; z-index: 9000; max-width: 125px;" src="//d379ifj7s9wntv.cloudfront.net/reactivemanifesto/images/ribbons/we-are-reactive-red-right.png"> </a>
	</body>
</html>
