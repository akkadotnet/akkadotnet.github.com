<!DOCTYPE html>
<!--[if IE 8]>			<html class="ie ie8"> <![endif]-->
<!--[if IE 9]>			<html class="ie ie9"> <![endif]-->
<!--[if gt IE 9]><!-->	<html> <!--<![endif]-->
	<head>
		<meta charset="utf-8" />
		<title> Routing |  Akka.NET</title>
		<meta name="keywords" content="Actor,Finite state machine, concurrency" />
		<meta name="description" content="" />
		<meta name="Author" content="Dorin Grigoras [www.stepofweb.com]" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />

		<!-- mobile settings -->
		<meta name="viewport" content="width=device-width, maximum-scale=1, initial-scale=1, user-scalable=0" />

		<!-- Favicon -->
		<link rel="shortcut icon" href="/assets/images/demo/favicon.ico" />

		<!-- WEB FONTS -->
		<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700,800&amp;subset=latin,latin-ext" rel="stylesheet" type="text/css" />

		<!-- CORE CSS -->
		<link href="/assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
		<link href="/assets/css/font-awesome.css" rel="stylesheet" type="text/css" />
		<link href="/assets/css/sky-forms.css" rel="stylesheet" type="text/css" />
		<link href="/assets/css/weather-icons.min.css" rel="stylesheet" type="text/css" />
		<link href="/assets/css/line-icons.css" rel="stylesheet" type="text/css" />
		<link href="/assets/plugins/owl-carousel/owl.pack.css" rel="stylesheet" type="text/css" />
		<link href="/assets/plugins/magnific-popup/magnific-popup.css" rel="stylesheet" type="text/css" />
		<link href="/assets/css/animate.css" rel="stylesheet" type="text/css" />
		<link href="/assets/css/flexslider.css" rel="stylesheet" type="text/css" />

		<!-- FAV ICON -->
		<link rel="shortcut icon" href="http://akkadotnet.github.io/favicon.ico?v=2" />

		<!-- REVOLUTION SLIDER -->
		<link href="/assets/css/revolution-slider.css" rel="stylesheet" type="text/css" />
		<link href="/assets/css/layerslider.css" rel="stylesheet" type="text/css" />

		<!-- BLOG -->
		<link href="/assets/css/layout-blog.css" rel="stylesheet" type="text/css" />

		<!-- THEME CSS -->
		<link href="/assets/css/essentials.css" rel="stylesheet" type="text/css" />
		<link href="/assets/css/layout.css" rel="stylesheet" type="text/css" />
		<link href="/assets/css/header-default.css" rel="stylesheet" type="text/css" />
		<link href="/assets/css/footer-default.css" rel="stylesheet" type="text/css" />
		<link href="/assets/css/color_scheme/red.css" rel="stylesheet" type="text/css" id="color_scheme" />
		<link href="/content/style.css" rel="stylesheet" type="text/css" />
		
		<!-- Highlighting -->
		<link href="https://highlightjs.org/static/styles/monokai_sublime.css" rel="stylesheet" type="text/css" />
	
		<!-- Morenizr -->
		<script type="text/javascript" src="/assets/plugins/modernizr.min.js"></script>

		<!--[if lte IE 8]>
			<script src="/assets/plugins/respond.js"></script>
		<![endif]-->
	</head>
	
	<!-- 
		Available body classes: 
			smoothscroll			= enable chrome browser smooth scroll
			grey 					= grey content background
			boxed 					= boxed style
			pattern1 ... pattern10 	= background pattern

		Background Image - add to body: 
			data-background="/assets/images/boxed_background/1.jpg"
	-->
	<body class="smoothscroll">

		<div id="wrapper">

			<div id="header"><!-- class="sticky" for sticky menu -->

				<!-- Top Bar -->
				<header id="topBar">
					<div class="container">

						<div class="pull-right fsize13 margin-top10 hide_mobile">

							<!-- mail , phone -->
							<a href="mailto:akkadotnet@gmail.com">AkkaDotNet@Gmail.com</a> &bull; 

							<div class="block text-right"><!-- social -->
								<a href="https://www.facebook.com/akkadotnet" class="social fa fa-facebook"></a>
								<a href="http://stackoverflow.com/questions/tagged/akka.net" class="social fa fa-stack-overflow"></a>
								<a href="https://twitter.com/AkkaDotNET" class="social fa fa-twitter"></a>
							</div><!-- /social -->

						</div>

						<!-- Logo -->
						<a class="logo" href="/">
							<img src="/content/images/akkalogo.png"  alt="" style="padding-top:10px;" />
						</a>

					</div><!-- /.container -->
				</header>
				<!-- /Top Bar -->


				<!-- Top Nav -->
				<header id="topNav">
					<div class="container">

						<!-- Mobile Menu Button -->
						<button class="btn btn-mobile" data-toggle="collapse" data-target=".nav-main-collapse">
							<i class="fa fa-bars"></i>
						</button>

						<!-- Search -->
						<form class="search" method="get" action="/search">
							<input type="text" class="form-control" name="q" value="" placeholder="Search">
							<button class="fa fa-search"></button>
						</form>
						<!-- /Search -->

						<!-- Top Nav -->
						<div class="navbar-collapse nav-main-collapse collapse">
							<nav class="nav-main">

								<!--
									NOTE
									
									For a regular link, remove "dropdown" class from LI tag and "dropdown-toggle" class from the href.
									Direct Link Example: 

									<li>
										<a href="#">HOME</a>
									</li>
								-->
								
								<!-- pageurl wiki/Routing -->
								<ul id="topMain" class="nav nav-pills nav-main">
									<li class="mega-menu">
										<a href="/">
											HOME <span>welcome</span>
										</a>
									</li>
									<li class="mega-menu">										
										<a href="/wiki/">DOCUMENTATION <span>Wiki</span></a>
									</li>
									<li class="mega-menu">
										<a href="https://github.com/akkadotnet/akka.net">CODE <span>Github repository</span></a>
									</li>
									<li class="mega-menu">
										<a href="https://groups.google.com/forum/?hl=sv#!forum/akkadotnet-user-list">MAILINGLIST <span>Discuss</span></a>
									</li>	
									<li class="mega-menu">
										<a href="https://github.com/akkadotnet/akka.net/issues">TRACKER <span>Issues and Features</span></a>
									</li>	
								</ul>

							</nav>
						</div>
						<!-- /Top Nav -->

					</div><!-- /.container -->
				</header>
				<!-- /Top Nav -->

			</div>

						<!-- PAGE TOP -->
			<section class="page-title">
				<div class="container">

					<header>

						<ul class="breadcrumb"><!-- breadcrumb -->
							<li><a href="/">Home</a></li>
							<li><a href="/wiki/">Wiki</a></li>
							<li class="active"> Routing  <a href="https://github.com/akkadotnet/akka.net/wiki/Routing/_edit"> (edit)</a></li>							
						</ul><!-- /breadcrumb -->

						<h2><!-- Page Title -->
							<strong>Akka.NET</strong> Wiki
						</h2><!-- /Page Title -->

					</header>

				</div>			
			</section>
			<!-- /PAGE TOP -->

			<!-- CONTENT -->
			<section>
				<div class="container">

					<div class="row">

						<!-- RIGHT COLUMNS -->
						<div class="col-md-3" id="toc">	
						</div>
						<!-- /RIGHT COLUMNS -->

						<!-- LEFT COLUMNS -->
						<div class="col-md-9">
							<div id="main_content">

								<h2 id="tl-dr-roundrobin-group-router-example">TL;DR RoundRobin Group router example</h2>
<pre><code class="hljs lang-csharp">var <span class="hljs-keyword">system</span> = ActorSystem.Create(<span class="hljs-string">"MySystem"</span>);

<span class="hljs-comment">//create workers</span>
<span class="hljs-keyword">system</span>.ActorOf&lt;Worker&gt;(<span class="hljs-string">"Worker1"</span>);
<span class="hljs-keyword">system</span>.ActorOf&lt;Worker&gt;(<span class="hljs-string">"Worker2"</span>);
<span class="hljs-keyword">system</span>.ActorOf&lt;Worker&gt;(<span class="hljs-string">"Worker3"</span>);
<span class="hljs-keyword">system</span>.ActorOf&lt;Worker&gt;(<span class="hljs-string">"Worker4"</span>);

<span class="hljs-comment">//create the router using round robin strategy</span>
var router = <span class="hljs-keyword">system</span>.ActorOf(new Props().WithRouter(new RoundRobinGroup(
<span class="hljs-string">"user/Worker1"</span>, <span class="hljs-string">"user/Worker2"</span>, <span class="hljs-string">"user/Worker3"</span>, <span class="hljs-string">"user/Worker4"</span>)));

<span class="hljs-comment">//pass messages via the router to the routees</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">20</span>; i++)
{
   router.Tell(i);
}
</code></pre>
<h1 id="routers">Routers</h1>
<p>Messages can be sent via a router to efficiently route them to destination actors, known as its routees. A Router can be used inside or outside of an actor, and you can manage the routees yourselves or use a self contained router actor with configuration capabilities.</p>
<p>Different routing strategies can be used, according to your application&#39;s needs. Akka comes with several useful routing strategies right out of the box. But, as you will see in this chapter, it is also possible to create your own.</p>
<div class="alert alert-success">
<p><strong>Note:</strong><br/>
In general, any message sent to a router will be sent onwards to its routees, but there is one exception.<br/>
The special <code>Broadcast</code> Messages will send to all of a router&#39;s routees</p>
</div>
<h2 id="routing-strategies">Routing strategies</h2>
<h3 id="broadcast">Broadcast</h3>
<p>The broadcast router will as the name implies, broadcast any message to all of its routees.</p>
<p><img class="img-responsive" src="https://raw.githubusercontent.com/wiki/akkadotnet/akka.net/images/BroadcastRouter.png" alt="Broadcast Router"></p>
<h3 id="roundrobin">RoundRobin</h3>
<p>A Router that uses round-robin to select a connection. For concurrent calls, round robin is just a best effort. </p>
<p><img class="img-responsive" src="https://raw.githubusercontent.com/wiki/akkadotnet/akka.net/images/RoundRobinRouter.png" alt="Round Robin Router"></p>
<h3 id="consistenthash">ConsistentHash</h3>
<p>A Router that uses consistent hashing to select a connection based on the sent message.</p>
<p>There is 3 ways to define what data to use for the consistent hash key.</p>
<ol>
<li>You can define hashMapping / <code>WithHashMapper</code> of the router to map incoming messages to their consistent hash key. This makes the decision transparent for the sender.</li>
<li>The messages may implement <code>Akka.Routing.ConsistentHashingRouter.ConsistentHashable</code>. The key is part of the message and it&#39;s convenient to define it together with the message definition.</li>
<li>The messages can be be wrapped in a <code>Akka.Routing.ConsistentHashingRouter.ConsistentHashableEnvelope</code> to define what data to use for the consistent hash key. The sender knows the key to use.</li>
</ol>
<p>These ways to define the consistent hash key can be use together and at the same time for one router. The hashMapping is tried first.</p>
<p><img class="img-responsive" src="https://raw.githubusercontent.com/wiki/akkadotnet/akka.net/images/ConsistentHashRouter.png" alt="ConsistentHash Router"></p>
<h4 id="usecase">Usecase</h4>
<p><code>ConsistentHash</code> can be very useful when dealing with <strong>&quot;Commands&quot;</strong> in the sense of <strong>CQRS</strong> or <strong>Domain Driven Design</strong>.
For example, let&#39;s assume we have the following incoming sequence of <strong>&quot;Customer Commands&quot;</strong>:</p>
<p><img class="img-responsive" src="https://raw.githubusercontent.com/wiki/akkadotnet/akka.net/images/ConsistentHash1.png" alt="ConsistentHash Router example"></p>
<p>In this case we might want to group all messages based on <strong>&quot;Customer ID&quot;</strong> (ID in the diagram).
By using a <code>ConsistentHash</code> router we can now process multiple commands in parallel for different Customers, while still processing messages for each specific Customer in ordered sequence, and thus preventing us from getting race conditions with ourselves when applying each command on each customer entity.</p>
<p><img class="img-responsive" src="https://raw.githubusercontent.com/wiki/akkadotnet/akka.net/images/ConsistentHash2.png" alt="ConsistentHash Router example"></p>
<h3 id="scattergatherfirstcompleted">ScatterGatherFirstCompleted</h3>
<p>Simple router that broadcasts the message to all routees, and replies with the first response. 
You have to defin the &#39;within: Duration&#39; parameter (f.e: within = 10 seconds). </p>
<p><img class="img-responsive" src="https://raw.githubusercontent.com/wiki/akkadotnet/akka.net/images/ScatterGatherFirstCompletedRouter.png" alt="ScatterGatherFirstCompleted Router"></p>
<h3 id="random">Random</h3>
<p>A Router that randomly selects one of the target connections to send a message to.</p>
<p>[No image yet]</p>
<h3 id="smallestmailbox">SmallestMailbox</h3>
<p>A Router that tries to send to the non-suspended routee with fewest messages in mailbox. The selection is done in this order:</p>
<ul>
<li>Pick any idle routee (not processing message) with empty mailbox</li>
<li>Pick any routee with empty mailbox</li>
<li>Pick routee with fewest pending messages in mailbox</li>
<li>Pick any remote routee, remote actors are consider lowest priority, since their mailbox size is unknown</li>
</ul>
<p><img class="img-responsive" src="https://raw.githubusercontent.com/wiki/akkadotnet/akka.net/images/SmallestMailbox.png" alt="SmallestMailbox Router"></p>
<h2 id="pools-vs-groups">Pools vs. Groups</h2>
<h3 id="pools">Pools</h3>
<p>Router &quot;Pools&quot; are routers that create their own worker actors, that is; you provide a <code>nrOfInstances</code> to the router and the router will handle routee creation by itself.</p>
<h3 id="groups">Groups</h3>
<p>Sometimes, rather than having the router actor create its routees, it is desirable to create routees separately and provide them to the router for its use. You can do this by passing an paths of the routees to the router&#39;s configuration. Messages will be sent with <code>ActorSelection</code> to these paths.</p>
<h2 id="how-routing-is-designed-within-akka-net">How Routing is Designed within Akka.NET</h2>
<p>On the surface routers look like normal actors, but they are actually implemented differently. Routers are designed to be extremely efficient at receiving messages and passing them quickly on to routees.</p>
<p>A normal actor can be used for routing messages, but an actor&#39;s single-threaded processing can become a bottleneck. Routers can achieve much higher throughput with an optimization to the usual message-processing pipeline that allows concurrent routing. This is achieved by embedding routers&#39; routing logic directly in their ActorRef rather than in the router actor. Messages sent to a router&#39;s ActorRef can be immediately routed to the routee, bypassing the single-threaded router actor entirely.</p>
<p>The cost to this is, of course, that the internals of routing code are more complicated than if routers were implemented with normal actors. Fortunately all of this complexity is invisible to consumers of the routing API. However, it is something to be aware of when implementing your own routers.</p>
<h2 id="supervision">Supervision</h2>
<p>Routees that are created by a pool router will be created as the router&#39;s children. The router is therefore also the children&#39;s supervisor.</p>
<p>The supervision strategy of the router actor can be configured with the supervisorStrategy property of the Pool. If no configuration is provided, routers default to a strategy of “always escalate”. This means that errors are passed up to the router&#39;s supervisor for handling. The router&#39;s supervisor will decide what to do about any errors.</p>
<p>Note the router&#39;s supervisor will treat the error as an error with the router itself. Therefore a directive to stop or restart will cause the router itself to stop or restart. The router, in turn, will cause its children to stop and restart.</p>
<p>It should be mentioned that the router&#39;s restart behavior has been overridden so that a restart, while still re-creating the children, will still preserve the same number of actors in the pool.</p>
<p>This means that if you have not specified supervisorStrategy of the router or its parent a failure in a routee will escalate to the parent of the router, which will by default restart the router, which will restart all routees (it uses Escalate and does not stop routees during restart). The reason is to make the default behave such that adding withRouter to a child’s definition does not change the supervision strategy applied to the child. This might be an inefficiency that you can avoid by specifying the strategy when defining the router.</p>


								<div class="sky-form boxed">
									<header>Leave a comment</header>
									<div style="padding:12px;">
									<div id="disqus_thread"></div>
					                <script type="text/javascript">
					                    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
					                    var disqus_shortname = 'akkanet'; // required: replace example with your forum shortname

					                    /* * * DON'T EDIT BELOW THIS LINE * * */
					                    (function () {
					                        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
					                        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
					                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
					                    })();
					                </script>
					                <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
					                <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
						            </div>
						        </div>
							</div>

						</div>
						<!-- /LEFT COLUMNS -->



					</div>

				</div>
			</section>
			<!-- /CONTENT -->


			<!-- FOOTER -->
			<footer id="footer">
				<div class="container">

					<div class="row">

						<!-- col #1 -->
						<div class="spaced dark col-md-3">
							<h4>About <strong>Akka.NET</strong></h4>
							<p class="block">
							Akka.NET is a port of the popular <br/>
							Java/Scala framework <a href="http://akka.io">Akka</a> to .NET.<br/>
							<br/>
							This is a community driven port and <br/>
							is not affiliated with <a href="http://typesafe.com">Typesafe</a> who <br/>
							makes the original Java/Scala version.<br/>
							</p>

							<p class="block"><!-- social -->
								<a href="https://www.facebook.com/akkadotnet" class="social fa fa-facebook"></a>
								<a href="http://stackoverflow.com/questions/tagged/akka.net" class="social fa fa-stack-overflow"></a>
								<a href="https://twitter.com/AkkaDotNET" class="social fa fa-twitter"></a>
							</p><!-- /social -->
						</div>
						<!-- /col #1 -->



						<!-- col #3 -->
						<div class="spaced col-md-6 col-sm-4">
							<h4>Recent <strong>Tweets</strong></h4>
							<ul class="list-unstyled fsize13" id="recent_tweets">
							<!--	<li>
									<i class="fa fa-twitter"></i> <a href="#">@John Doe</a> Pilsum dolor lorem sit consectetur adipiscing orem sequat <small class="ago">8 mins ago</small>
								</li>
								<li>
									<i class="fa fa-twitter"></i> <a href="#">@John Doe</a> Remonde sequat ipsum dolor lorem sit consectetur adipiscing  <small class="ago">8 mins ago</small>
								</li>
								<li>
									<i class="fa fa-twitter"></i> <a href="#">@John Doe</a> Imperdiet condimentum diam dolor lorem sit consectetur adipiscing <small class="ago">8 mins ago</small>
								</li>-->
							</ul>
						</div>
						<!-- /col #3 -->
						
						<div class="spaced col-md-3 col-sm-4">
							<h4>Keep <strong>Updated</strong></h4>

							<h4><small><strong>Subscribe to our Newsletter</strong></small></h4>

							
							<!-- Begin MailChimp Signup Form -->
							<div id="mc_embed_signup">
							<form class="input-group" action="//github.us8.list-manage.com/subscribe/post?u=945d2a2edaa89aaabd396bc45&amp;id=5f9a7a993d" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
						
								<input type="email" value="" name="EMAIL" class="form-control placeholder required email" id="mce-EMAIL" placeholder="E-mail Address" >
								<span class="input-group-btn">
									<button class="btn btn-primary" type="submit" name="subscribe" id="mc-embedded-subscribe">SUBMIT</button>
								</span>
					
								<div id="mce-responses" class="clear">
									<div class="response" id="mce-error-response" style="display:none"></div>
									<div class="response" id="mce-success-response" style="display:none"></div>
								</div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
							    <div style="position: absolute; left: -5000px;"><input type="text" name="b_945d2a2edaa89aaabd396bc45_5f9a7a993d" tabindex="-1" value=""></div>
							    <div class="clear"></div>
							</form>
							</div>
							
							<!--End mc_embed_signup-->

						</div>
					</div>

				</div>

				<hr />

				<div class="copyright">
					<div class="container text-center fsize12">
						<!--Epona theme by <a href="http://www.stepofweb.com" target="_blank" title="bootstrap themes &amp; templates" class="copyright">stepofweb</a> &bull; All Right Reserved &copy; Your Company LLC. &nbsp;
						<a href="page-privacy.html" class="fsize11">Privacy Policy</a> &bull; 
						<a href="page-terms.html" class="fsize11">Terms of Service</a>-->
					</div>
				</div>
			</footer>
			<!-- /FOOTER -->

			<a href="#" id="toTop"></a>

		</div><!-- /#wrapper -->

		<!-- JAVASCRIPT FILES -->
		<script type="text/javascript" src="/assets/plugins/jquery-2.1.1.min.js"></script>
		<script type="text/javascript" src="/assets/plugins/jquery.isotope.js"></script>
		<script type="text/javascript" src="/assets/plugins/masonry.js"></script>

		<script type="text/javascript" src="/assets/plugins/bootstrap/js/bootstrap.min.js"></script>
		<script type="text/javascript" src="/assets/plugins/magnific-popup/jquery.magnific-popup.min.js"></script>
		<script type="text/javascript" src="/assets/plugins/owl-carousel/owl.carousel.min.js"></script>
		<script type="text/javascript" src="/assets/plugins/knob/js/jquery.knob.js"></script>
		<script type="text/javascript" src="/assets/plugins/flexslider/jquery.flexslider-min.js"></script>

		<!-- REVOLUTION SLIDER -->
		<script type="text/javascript" src="/assets/plugins/revolution-slider/js/jquery.themepunch.plugins.min.js"></script>
		<script type="text/javascript" src="/assets/plugins/revolution-slider/js/jquery.themepunch.revolution.min.js"></script>
		<script type="text/javascript" src="/assets/js/revolution_slider.js"></script>
		<script type="text/javascript" src="/content/jquery-toc.js"></script>


		<script type="text/javascript" src="/assets/js/scripts.js"></script>
		<script type="text/javascript" src="/content/scripts.js"></script>
		<a href="http://www.reactivemanifesto.org/"> <img style="border: 0px currentColor; left: 0px; top: 0px; position: fixed; z-index: 9000;" src="http://www.reactivemanifesto.org/images/ribbons/we-are-reactive-red-left.png"> </a>
	</body>
</html>
